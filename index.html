<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Personal Time Clock</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg: #0f172a;
        --surface: rgba(15, 23, 42, 0.85);
        --panel: rgba(15, 23, 42, 0.9);
        --border: rgba(148, 163, 184, 0.12);
        --text: #e2e8f0;
        --muted: #94a3b8;
        --accent: #38bdf8;
        --accent-strong: #0ea5e9;
        --success: #22c55e;
        --danger: #ef4444;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(160deg, #0b1220 0%, #020617 55%, #111827 100%);
        background-attachment: fixed;
        color: var(--text);
      }

      .wrapper {
        max-width: 1100px;
        margin: 0 auto;
        padding: 32px 18px 48px;
        display: grid;
        gap: 24px;
      }

      header h1 {
        margin: 0 0 8px;
        font-size: clamp(28px, 4vw, 44px);
        letter-spacing: -0.02em;
      }

      header p {
        margin: 0;
        color: var(--muted);
      }

      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 22px 24px;
        backdrop-filter: blur(16px);
        box-shadow: 0 25px 45px -30px rgba(15, 23, 42, 0.75);
      }

      .grid {
        display: grid;
        gap: 24px;
      }

      @media (min-width: 960px) {
        .grid-two {
          grid-template-columns: 1.05fr 0.95fr;
        }
      }

      label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 6px;
        font-weight: 600;
        color: #cbd5f5;
      }

      input[type="time"],
      input[type="date"],
      input[type="number"],
      input[type="text"],
      textarea {
        width: 100%;
        padding: 11px 12px;
        border-radius: 12px;
        border: 1px solid var(--border);
        background: rgba(8, 13, 23, 0.8);
        color: var(--text);
        font-size: 0.97rem;
        transition: border 0.25s ease, box-shadow 0.25s ease;
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: rgba(56, 189, 248, 0.7);
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.22);
      }

      .row {
        display: grid;
        gap: 18px;
      }

      @media (min-width: 640px) {
        .row.two {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }

      button {
        appearance: none;
        border: none;
        background: linear-gradient(135deg, var(--accent), var(--accent-strong));
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, filter 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 18px 30px -20px rgba(14, 165, 233, 0.85);
      }

      button:hover {
        transform: translateY(-1px);
        filter: brightness(1.05);
      }

      button:active {
        transform: translateY(1px);
      }

      button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        filter: grayscale(0.15);
        transform: none;
        box-shadow: none;
      }

      .secondary-btn {
        background: transparent;
        border: 1px solid rgba(148, 163, 184, 0.4);
        color: var(--muted);
        box-shadow: none;
      }

      .secondary-btn:hover {
        color: #f8fafc;
        border-color: rgba(148, 163, 184, 0.9);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
        font-size: 0.95rem;
      }

      thead {
        color: rgba(226, 232, 240, 0.85);
        font-weight: 600;
      }

      th,
      td {
        padding: 12px 10px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.15);
      }

      tbody tr:hover {
        background: rgba(148, 163, 184, 0.08);
      }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 999px;
        background: rgba(56, 189, 248, 0.12);
        color: #bae6fd;
        font-size: 0.85rem;
      }

      .stat-cards {
        display: grid;
        gap: 18px;
      }

      @media (min-width: 520px) {
        .stat-cards {
          grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
        }
      }

      .stat-card {
        background: rgba(15, 23, 42, 0.75);
        border: 1px solid rgba(148, 163, 184, 0.1);
        border-radius: 16px;
        padding: 16px 18px;
        display: grid;
        gap: 4px;
      }

      .stat-card span {
        color: rgba(148, 163, 184, 0.85);
        font-size: 0.82rem;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .stat-card strong {
        font-size: 1.55rem;
        letter-spacing: -0.01em;
      }

      .empty {
        color: rgba(148, 163, 184, 0.75);
        text-align: center;
        padding: 18px 0;
      }

      .actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
      }

      .tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(34, 197, 94, 0.14);
        color: rgba(134, 239, 172, 0.95);
        font-size: 0.78rem;
      }

      .daily-rollup {
        display: grid;
        gap: 10px;
        margin-top: 18px;
      }

      .daily-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(8, 13, 23, 0.75);
        border: 1px solid rgba(148, 163, 184, 0.12);
        padding: 12px 14px;
        border-radius: 12px;
        font-size: 0.95rem;
      }

      .delete-btn {
        background: transparent;
        border: 1px solid rgba(248, 113, 113, 0.5);
        color: rgba(248, 113, 113, 0.9);
        padding: 6px 12px;
        border-radius: 10px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: border 0.25s ease, color 0.25s ease, transform 0.2s ease;
      }

      .delete-btn:hover {
        border-color: rgba(248, 113, 113, 1);
        color: #fee2e2;
        transform: translateY(-1px);
      }

      footer {
        text-align: center;
        color: rgba(148, 163, 184, 0.65);
        font-size: 0.75rem;
        margin-top: 40px;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Personal Time Clock</h1>
        <p>Track your working hours, daily totals, and earnings at a glance.</p>
      </header>

      <div class="grid grid-two">
        <section class="card">
          <h2 style="margin-top: 0">Log your time</h2>
          <form id="entryForm" class="grid" autocomplete="off">
            <div class="row two">
              <div>
                <label for="entryDate">Date</label>
                <input type="date" id="entryDate" required />
              </div>
              <div>
                <label for="hourlyRate">Hourly rate ($)</label>
                <input
                  type="number"
                  id="hourlyRate"
                  min="0"
                  step="0.01"
                  value="25"
                  required
                />
              </div>
            </div>
            <div class="row two">
              <div>
                <label for="startTime">Clock in</label>
                <input type="time" id="startTime" value="08:00" required />
              </div>
              <div>
                <label for="endTime">Clock out</label>
                <input type="time" id="endTime" value="16:00" required />
              </div>
            </div>
            <div>
              <label for="note">Notes (optional)</label>
              <input type="text" id="note" placeholder="What did you work on?" />
            </div>

            <div class="stat-cards" aria-live="polite">
              <div class="stat-card">
                <span>Preview duration</span>
                <strong id="previewHours">0h 00m</strong>
              </div>
              <div class="stat-card">
                <span>Preview earnings</span>
                <strong id="previewPay">$0.00</strong>
              </div>
            </div>

            <div class="actions">
              <button type="submit">Add time entry</button>
              <button type="button" class="secondary-btn" id="clearAll">Clear all entries</button>
            </div>
          </form>
        </section>

        <section class="card">
          <h2 style="margin-top: 0">Totals</h2>
          <div class="stat-cards">
            <div class="stat-card">
              <span>Total hours logged</span>
              <strong id="totalHours">0h 00m</strong>
            </div>
            <div class="stat-card">
              <span>Total earnings</span>
              <strong id="totalEarnings">$0.00</strong>
            </div>
            <div class="stat-card">
              <span>Average hours / day</span>
              <strong id="avgHours">0h 00m</strong>
            </div>
          </div>
          <div class="daily-rollup" id="dailyRollup" aria-live="polite"></div>
          <div class="actions">
            <button type="button" id="generateInvoice">Generate invoice PDF</button>
          </div>
          <p style="margin-top: 8px; color: var(--muted); font-size: 0.85rem">
            The generated invoice includes placeholder business, client, and routing details.
          </p>
        </section>
      </div>

      <section class="card">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap">
          <div>
            <h2 style="margin: 0">Time entries</h2>
            <p style="margin: 4px 0 0; color: var(--muted)">All your logged sessions are stored locally in this browser.</p>
          </div>
          <div class="pill" id="entryCount">
            <span class="sr-only">Entry count:</span>
            <span id="entryTotal">0</span>
            entries tracked
          </div>
        </div>
        <div style="overflow-x: auto">
          <table aria-describedby="entryCount">
            <thead>
              <tr>
                <th scope="col">Date</th>
                <th scope="col">Clock in</th>
                <th scope="col">Clock out</th>
                <th scope="col">Duration</th>
                <th scope="col">Earnings</th>
                <th scope="col">Notes</th>
                <th scope="col"><span class="sr-only">Actions</span></th>
              </tr>
            </thead>
            <tbody id="entryTable"></tbody>
          </table>
        </div>
      </section>

      <footer>
        Your data is kept locally in your browser using local storage.
      </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      const $ = (sel) => document.querySelector(sel);
      const entryForm = $('#entryForm');
      const entryDate = $('#entryDate');
      const startTime = $('#startTime');
      const endTime = $('#endTime');
      const note = $('#note');
      const hourlyRate = $('#hourlyRate');
      const previewHours = $('#previewHours');
      const previewPay = $('#previewPay');
      const entryTable = $('#entryTable');
      const totalHours = $('#totalHours');
      const totalEarnings = $('#totalEarnings');
      const avgHours = $('#avgHours');
      const entryTotal = $('#entryTotal');
      const clearAllBtn = $('#clearAll');
      const dailyRollup = $('#dailyRollup');
      const generateInvoiceBtn = $('#generateInvoice');

      const STORAGE_KEY = 'time-clock-entries-v1';
      const RATE_KEY = 'time-clock-rate-v1';

      let entries = [];

      function loadState() {
        try {
          const savedEntries = localStorage.getItem(STORAGE_KEY);
          const savedRate = localStorage.getItem(RATE_KEY);
          if (savedEntries) {
            const parsed = JSON.parse(savedEntries);
            if (Array.isArray(parsed)) {
              entries = parsed;
            }
          }
          if (savedRate) {
            const n = Number(savedRate);
            if (!Number.isNaN(n)) {
              hourlyRate.value = n.toFixed(2);
            }
          }
        } catch (err) {
          console.error('Failed to load saved data', err);
          entries = [];
        }
      }

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
        localStorage.setItem(RATE_KEY, hourlyRate.value || '25');
      }

      function setDefaultDate() {
        const today = new Date();
        const iso = today.toISOString().slice(0, 10);
        entryDate.value = entryDate.value || iso;
      }

      function parseDateTime(dateStr, timeStr) {
        const [hour, minute] = timeStr.split(':').map(Number);
        const date = new Date(dateStr + 'T00:00:00');
        date.setHours(hour);
        date.setMinutes(minute);
        return date;
      }

      function formatDuration(ms) {
        const totalMinutes = Math.round(ms / 60000);
        const hours = Math.floor(totalMinutes / 60);
        const minutes = Math.abs(totalMinutes % 60);
        return `${hours}h ${String(minutes).padStart(2, '0')}m`;
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
        }).format(amount);
      }

      function computeDuration(dateStr, startStr, endStr) {
        const start = parseDateTime(dateStr, startStr);
        let end = parseDateTime(dateStr, endStr);
        if (end <= start) {
          // Assume the shift passes midnight
          end = new Date(end.getTime() + 24 * 60 * 60 * 1000);
        }
        return end - start;
      }

      function updatePreview() {
        if (!entryDate.value || !startTime.value || !endTime.value) {
          previewHours.textContent = '0h 00m';
          previewPay.textContent = '$0.00';
          return;
        }

        const duration = computeDuration(entryDate.value, startTime.value, endTime.value);
        const rate = Number(hourlyRate.value || '0');
        const hoursDecimal = duration / 3600000;
        previewHours.textContent = formatDuration(duration);
        previewPay.textContent = formatCurrency(hoursDecimal * rate);
      }

      function render() {
        if (!Array.isArray(entries)) {
          entries = [];
        }
        const sorted = entries.slice().sort((a, b) => {
          return new Date(a.startISO) - new Date(b.startISO);
        });

        entryTable.innerHTML = '';
        let totalMs = 0;
        let totalPay = 0;
        const byDay = new Map();

        for (const entry of sorted) {
          const row = document.createElement('tr');
          const durationMs = entry.durationMs;
          const pay = entry.pay;
          totalMs += durationMs;
          totalPay += pay;

          const start = new Date(entry.startISO);
          const end = new Date(entry.endISO);
          const dateKey = entry.date;

          const dayData = byDay.get(dateKey) || { ms: 0, pay: 0 };
          dayData.ms += durationMs;
          dayData.pay += pay;
          byDay.set(dateKey, dayData);

          row.innerHTML = `
            <td>${start.toLocaleDateString()}</td>
            <td>${start.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
            <td>${end.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
            <td>${formatDuration(durationMs)}</td>
            <td>${formatCurrency(pay)}</td>
            <td>${entry.note ? entry.note : ''}</td>
            <td style="text-align:right">
              <button class="delete-btn" data-id="${entry.id}">Remove</button>
            </td>
          `;
          entryTable.appendChild(row);
        }

        if (!sorted.length) {
          const emptyRow = document.createElement('tr');
          emptyRow.innerHTML = `
            <td colspan="7" class="empty">No entries yet. Add your first session above.</td>
          `;
          entryTable.appendChild(emptyRow);
        }

        totalHours.textContent = formatDuration(totalMs);
        totalEarnings.textContent = formatCurrency(totalPay);

        entryTotal.textContent = sorted.length;
        if (generateInvoiceBtn) {
          generateInvoiceBtn.disabled = sorted.length === 0;
        }

        const uniqueDays = byDay.size;
        const avgMs = uniqueDays ? totalMs / uniqueDays : 0;
        avgHours.textContent = formatDuration(avgMs);

        dailyRollup.innerHTML = '';
        if (byDay.size) {
          const days = Array.from(byDay.entries()).sort((a, b) => new Date(a[0]) - new Date(b[0]));
          for (const [dateKey, data] of days) {
            const div = document.createElement('div');
            div.className = 'daily-row';
            div.innerHTML = `
              <span>${new Date(dateKey).toLocaleDateString()}</span>
              <span class="tag">${formatDuration(data.ms)} · ${formatCurrency(data.pay)}</span>
            `;
            dailyRollup.appendChild(div);
          }
        }
      }

      function addEntry(event) {
        event.preventDefault();
        if (!entryForm.reportValidity()) {
          return;
        }

        const dateStr = entryDate.value;
        const startStr = startTime.value;
        const endStr = endTime.value;
        const rate = Number(hourlyRate.value || '0');

        const durationMs = computeDuration(dateStr, startStr, endStr);
        if (durationMs <= 0) {
          alert('End time must be after start time.');
          return;
        }

        const hoursDecimal = durationMs / 3600000;
        const pay = +(hoursDecimal * rate).toFixed(2);

        const startISO = parseDateTime(dateStr, startStr).toISOString();
        const endISO = new Date(parseDateTime(dateStr, startStr).getTime() + durationMs).toISOString();

        const entry = {
          id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
          date: dateStr,
          startISO,
          endISO,
          durationMs,
          pay,
          rate,
          note: note.value.trim(),
        };

        entries.push(entry);
        saveState();
        render();

        note.value = '';
        updatePreview();
        entryForm.reset();
        setDefaultDate();
        startTime.value = '08:00';
        endTime.value = '16:00';
        hourlyRate.value = Number(rate).toFixed(2);
      }

      function deleteEntry(id) {
        entries = entries.filter((entry) => entry.id !== id);
        saveState();
        render();
      }

      function clearAll() {
        if (!entries.length) return;
        const confirmed = confirm('Remove all saved time entries?');
        if (!confirmed) return;
        entries = [];
        saveState();
        render();
      }

      function generateInvoice() {
        if (!window.jspdf || !window.jspdf.jsPDF) {
          alert('Invoice generator is unavailable. Please check your connection and try again.');
          return;
        }
        if (!entries.length) {
          alert('Add time entries before generating an invoice.');
          return;
        }

        const sorted = entries
          .slice()
          .sort((a, b) => new Date(a.startISO) - new Date(b.startISO));

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'pt', format: 'letter' });

        const margin = 48;
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        let y = margin;

        const today = new Date();
        const invoiceNumber = `INV-${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}${String(
          today.getDate()
        ).padStart(2, '0')}-${String(sorted.length).padStart(3, '0')}`;

        doc.setFont('helvetica', 'bold');
        doc.setFontSize(22);
        doc.text('Invoice', margin, y);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'normal');
        y += 26;
        doc.text(`Invoice #: ${invoiceNumber}`, margin, y);
        y += 16;
        doc.text(`Invoice Date: ${today.toLocaleDateString()}`, margin, y);
        y += 24;

        const fromLines = [
          'Your Name or Business',
          '123 Placeholder Street',
          'City, ST 12345',
          'email@example.com',
          'Phone: (555) 123-4567',
        ];
        const toLines = [
          'Client Name',
          'Client Company',
          '456 Client Avenue',
          'City, ST 67890',
          'client@example.com',
        ];

        doc.setFont('helvetica', 'bold');
        doc.text('From', margin, y);
        doc.text('Bill To', margin + 260, y);
        doc.setFont('helvetica', 'normal');
        y += 16;

        const maxLines = Math.max(fromLines.length, toLines.length);
        for (let i = 0; i < maxLines; i += 1) {
          if (fromLines[i]) {
            doc.text(fromLines[i], margin, y + i * 14);
          }
          if (toLines[i]) {
            doc.text(toLines[i], margin + 260, y + i * 14);
          }
        }
        y += maxLines * 14 + 20;

        doc.setFont('helvetica', 'bold');
        doc.text('Payment Details', margin, y);
        doc.setFont('helvetica', 'normal');
        y += 16;
        const paymentLines = [
          'Bank: Placeholder Bank',
          'Routing Number: 000000000',
          'Account Number: 000123456789',
          'Payment Terms: Due upon receipt',
        ];
        paymentLines.forEach((line) => {
          doc.text(line, margin, y);
          y += 14;
        });
        y += 10;

        const columns = [
          { label: 'Date', x: margin },
          { label: 'Hours', x: margin + 120 },
          { label: 'Rate', x: margin + 200 },
          { label: 'Amount', x: margin + 280 },
        ];
        const notesX = margin + 360;
        const notesWidth = Math.max(120, pageWidth - margin - notesX);

        function drawTableHeader() {
          doc.setFont('helvetica', 'bold');
          doc.text('Date', columns[0].x, y);
          doc.text('Hours', columns[1].x, y);
          doc.text('Rate', columns[2].x, y);
          doc.text('Amount', columns[3].x, y);
          doc.text('Notes', notesX, y);
          y += 14;
          doc.setLineWidth(0.5);
          doc.line(margin, y, pageWidth - margin, y);
          y += 10;
          doc.setFont('helvetica', 'normal');
        }

        function ensureSpace(heightNeeded) {
          if (y + heightNeeded > pageHeight - margin) {
            doc.addPage();
            y = margin;
            drawTableHeader();
          }
        }

        drawTableHeader();

        let totalHoursDecimal = 0;
        let totalPay = 0;

        sorted.forEach((entry) => {
          const start = new Date(entry.startISO);
          const hoursDecimal = entry.durationMs / 3600000;
          totalHoursDecimal += hoursDecimal;
          totalPay += entry.pay;

          const noteLines = entry.note ? doc.splitTextToSize(entry.note, notesWidth) : ['—'];
          const rowHeight = Math.max(16, noteLines.length * 14);

          ensureSpace(rowHeight + 24);

          doc.text(start.toLocaleDateString(), columns[0].x, y);
          doc.text(hoursDecimal.toFixed(2), columns[1].x, y);
          doc.text(`${formatCurrency(entry.rate)}/hr`, columns[2].x, y);
          doc.text(formatCurrency(entry.pay), columns[3].x, y);
          noteLines.forEach((line, idx) => {
            doc.text(line, notesX, y + idx * 14);
          });
          y += rowHeight;
        });

        ensureSpace(60);
        y += 10;
        doc.setFont('helvetica', 'bold');
        doc.text('Summary', margin, y);
        y += 16;
        doc.setFont('helvetica', 'normal');
        doc.text(`Total hours: ${totalHoursDecimal.toFixed(2)}`, margin, y);
        y += 14;
        doc.text(`Total amount due: ${formatCurrency(totalPay)}`, margin, y);
        y += 18;
        doc.text('Please update the placeholder details before sending to your client.', margin, y);
        y += 14;
        doc.text('Thank you for your business!', margin, y);

        const filename = `invoice-${today.toISOString().slice(0, 10)}.pdf`;
        doc.save(filename);
      }

      entryForm.addEventListener('submit', addEntry);

      entryTable.addEventListener('click', (event) => {
        const target = event.target;
        if (target.matches('button[data-id]')) {
          deleteEntry(target.getAttribute('data-id'));
        }
      });

      hourlyRate.addEventListener('input', () => {
        updatePreview();
        saveState();
      });

      [entryDate, startTime, endTime].forEach((input) => {
        input.addEventListener('input', updatePreview);
      });

      clearAllBtn.addEventListener('click', clearAll);
      if (generateInvoiceBtn) {
        generateInvoiceBtn.addEventListener('click', generateInvoice);
      }

      document.addEventListener('DOMContentLoaded', () => {
        setDefaultDate();
        loadState();
        setDefaultDate();
        updatePreview();
        render();
      });
    </script>
  </body>
</html>
